# Общее

Сетевые протоколы – это наборы правил, которые определяют, как компьютеры и устройства взаимодействуют друг с другом в сети. Вот несколько самых популярных и широко используемых протоколов:
### 1. **HTTP (Hypertext Transfer Protocol) и HTTPS (HTTP Secure)**
- **HTTP** – основной протокол для передачи данных в интернете. Он используется для загрузки веб-страниц и работает на порту 80. Это текстовый протокол, который позволяет браузерам и серверам обмениваться информацией.
- **HTTPS** – защищённая версия HTTP, которая использует шифрование SSL/TLS для защиты данных. HTTPS работает на порту 443 и обеспечивает безопасность передачи информации, что особенно важно для сайтов с конфиденциальной информацией, такими как интернет-магазины и банки.
### 2. **FTP (File Transfer Protocol)**
- **FTP** – протокол для передачи файлов между устройствами в сети. Он используется для загрузки и скачивания файлов с серверов. Работает на портах 20 и 21. Протокол FTP изначально не поддерживает шифрование, но для защиты данных используется его расширение – FTPS (FTP Secure), которое применяет SSL/TLS.
### 3. **SMTP (Simple Mail Transfer Protocol), POP3 (Post Office Protocol) и IMAP (Internet Message Access Protocol)**
- **SMTP** – протокол для отправки электронной почты с сервера отправителя на сервер получателя. Работает на порте 25. SMTP отправляет сообщения, но не отвечает за их получение.
- **POP3** и **IMAP** – протоколы для получения почты.
    - **POP3** (порт 110) загружает письма с сервера на устройство пользователя и, как правило, удаляет их с сервера.
    - **IMAP** (порт 143) позволяет работать с письмами, остающимися на сервере, поддерживает синхронизацию и отлично подходит для доступа к почте с нескольких устройств.
### 4. **TCP (Transmission Control Protocol) и UDP (User Datagram Protocol)**
- **TCP** – протокол транспортного уровня, обеспечивающий надёжную передачу данных. Работает в паре с IP (Интернет-протоколом) и используется там, где критически важна точность данных, например, в HTTP, FTP и электронной почте.
- **UDP** – альтернативный протокол, который не проверяет целостность данных, поэтому подходит для приложений, где важна скорость, а не точность, например, для онлайн-видео и аудиотрансляций, игр.
### 5. **IP (Internet Protocol)**
- **IP** – протокол сетевого уровня, который отвечает за адресацию и маршрутизацию пакетов данных. IPv4 и IPv6 – две основные версии протокола IP. IPv4 использует 32-битные адреса, что ограничивает количество уникальных IP-адресов, а IPv6 – 128-битные, что решает проблему дефицита адресов.
### 6. **DNS (Domain Name System)**
- **DNS** – система доменных имён, которая преобразует понятные человеку имена (например, google.com) в IP-адреса, которые используют устройства для связи друг с другом. Протокол DNS работает на порту 53 и играет ключевую роль в интернет-соединениях.
### 7. **DHCP (Dynamic Host Configuration Protocol)**
- **DHCP** – протокол, который автоматически назначает IP-адреса устройствам в сети. Когда новое устройство подключается, DHCP-сервер назначает ему IP-адрес, шлюз по умолчанию и другие параметры. Это упрощает управление сетью и позволяет устройствам легко подключаться к сети.
### 8. **SNMP (Simple Network Management Protocol)**
- **SNMP** – протокол для мониторинга и управления сетевыми устройствами, такими как роутеры, принтеры и сервера. Работает на портах 161 и 162 и позволяет администраторам получать информацию о статусе устройств, обнаруживать сбои и управлять настройками удалённых устройств.
### 9. **Telnet и SSH (Secure Shell)**
- **Telnet** – протокол для удалённого доступа к устройствам. Он позволяет управлять устройством через командную строку, но не шифрует данные.
- **SSH** – более защищённая альтернатива Telnet, использующая шифрование. SSH (порт 22) позволяет безопасно администрировать удалённые серверы и сетевые устройства, что важно для конфиденциальности и защиты данных.
### 10. **ICMP (Internet Control Message Protocol)**
- **ICMP** – вспомогательный протокол, который используется для отправки сообщений об ошибках и диагностической информации. Например, команды `ping` и `traceroute` используют ICMP для проверки доступности устройства и отслеживания маршрутов пакетов.

--- 

# Под капотом

Сетевые протоколы устроены как многоуровневая система, в которой каждый уровень отвечает за свою часть передачи данных. Для понимания того, как работают сетевые протоколы "под капотом", полезно представить их в контексте модели OSI (Open Systems Interconnection) или более простой модели TCP/IP, где каждый протокол относится к конкретному уровню. Давайте разберём основные протоколы с техническими деталями, которые раскрывают их внутреннее устройство и принципы работы.

---
## TCP and UDP
### TCP (Transmission Control Protocol)

TCP – это надёжный, ориентированный на соединение протокол, который используется в тех случаях, когда важна гарантия доставки данных и сохранение их порядка. Он состоит из нескольких этапов, которые обеспечивают его надежность.

#### Основные особенности TCP:
- **Надёжность**: TCP обеспечивает доставку пакетов данных и гарантирует, что они будут получены в правильном порядке.
- **Установление соединения**: TCP требует установления соединения между отправителем и получателем.
- **Контроль ошибок**: TCP использует контрольные суммы и механизм подтверждений (ACK) для проверки целостности данных.
- **Управление потоком и перегрузкой**: TCP регулирует скорость передачи данных, чтобы избежать перегрузки сети.

#### Как TCP работает:

1. **Трёхстороннее рукопожатие** (Three-way handshake):
   - Перед началом передачи данных TCP устанавливает соединение между клиентом и сервером с помощью процесса "трёхстороннего рукопожатия".
   - **SYN**: Клиент отправляет серверу пакет SYN (синхронизации), чтобы инициировать соединение.
   - **SYN-ACK**: Сервер отвечает пакетом SYN-ACK (подтверждение синхронизации), подтверждая получение SYN.
   - **ACK**: Клиент отправляет серверу подтверждение ACK, после чего соединение установлено и данные могут передаваться.

2. **Передача данных**:
   - TCP разбивает данные на сегменты и пронумеровывает их с помощью **порядковых номеров** (sequence numbers).
   - Каждый сегмент данных отправляется с контрольной суммой. Получатель проверяет контрольную сумму и отправляет **подтверждение** (ACK) для каждого корректно полученного сегмента.
   - Если сегмент не был получен, TCP повторно отправляет его, обеспечивая надёжность.

3. **Управление потоком**:
   - TCP регулирует скорость передачи данных, основываясь на текущих условиях сети и возможностях получателя, используя окно скользящего потока (**Sliding Window**).
   - При заполнении окна, отправитель ожидает подтверждений от получателя, прежде чем отправлять новые данные.

4. **Контроль перегрузки**:
   - TCP использует алгоритмы для управления перегрузкой сети, такие как **алгоритм медленного старта** и **алгоритм избегания перегрузки**.
   - Эти алгоритмы адаптируют скорость передачи данных, замедляя её, если обнаружена перегрузка, и ускоряя, когда сеть стабилизируется.

5. **Завершение соединения**:
   - TCP завершает соединение с помощью **четырёхстороннего завершения** (four-way handshake).
   - Одна из сторон (например, клиент) отправляет пакет **FIN**.
   - Другая сторона подтверждает его с **ACK**, затем отправляет свой **FIN**.
   - Клиент отвечает пакетом **ACK**, завершая соединение.

---

### UDP (User Datagram Protocol)

UDP – это более простой протокол, не требующий установления соединения и не обеспечивающий надёжности. Он используется в тех случаях, когда важнее скорость передачи данных, чем их точная доставка.

#### Основные особенности UDP:
- **Отсутствие надёжности**: UDP не проверяет, были ли получены пакеты, и не гарантирует их порядок.
- **Нет установления соединения**: UDP не требует процесса "рукопожатия" для начала передачи данных.
- **Отсутствие управления потоком**: UDP не регулирует скорость передачи и не проверяет, перегружена ли сеть.
- **Минимальные накладные расходы**: заголовок UDP меньше, чем у TCP, что делает его более быстрым и лёгким для пересылки.

#### Как UDP работает:

1. **Отправка датаграмм**:
   - Данные передаются в виде **датаграмм** (datagrams), каждая из которых считается отдельной единицей данных. Каждая датаграмма обрабатывается независимо, даже если она является частью серии пакетов.
   - UDP не разделяет данные на сегменты, как TCP, и не присваивает им порядковые номера.

2. **Отсутствие подтверждений**:
   - В отличие от TCP, UDP не требует подтверждения получения данных. Отправитель отправляет датаграмму и не отслеживает, была ли она получена.
   - Если датаграмма потеряна, отправитель не предпринимает попыток её повторной отправки.

3. **Структура UDP-заголовка**:
   - Заголовок UDP состоит всего из четырёх полей:
      - **Порт отправителя**: порт, с которого отправляются данные.
      - **Порт получателя**: порт, на который отправляются данные.
      - **Длина**: общая длина заголовка и данных в байтах.
      - **Контрольная сумма**: используется для проверки целостности данных.
   - За счёт минимального заголовка UDP имеет низкие накладные расходы, что делает его быстрее и менее ресурсоёмким.

#### Применение UDP:
   - **Онлайн-видео и аудио**: в потоковых приложениях, таких как видеотрансляции, важнее минимальная задержка, чем точная доставка данных, так как потерянные пакеты данных не приводят к серьёзным нарушениям в потоке.
   - **Онлайн-игры**: в реальном времени потери данных менее критичны, чем задержки. UDP позволяет быстрее передавать данные, что улучшает отклик в играх.
   - **DNS**: для DNS-запросов и ответов, где быстрый обмен данными важен для общей производительности, также используется UDP.

---

### Сравнение TCP и UDP

| Характеристика          | TCP                                                | UDP                                |
| ----------------------- | -------------------------------------------------- | ---------------------------------- |
| **Тип соединения**      | Ориентирован на соединение                         | Без соединения                     |
| **Надёжность**          | Гарантирует доставку, порядок и целостность данных | Не гарантирует доставку и порядок  |
| **Контроль потока**     | Есть                                               | Нет                                |
| **Контроль перегрузки** | Есть                                               | Нет                                |
| **Накладные расходы**   | Высокие (больше данных в заголовке)                | Низкие (меньше данных в заголовке) |
| **Применение**          | HTTP, HTTPS, FTP, SMTP                             | Стриминг, игры, DNS                |

--- 

## OSI

Модель OSI (Open Systems Interconnection) – это теоретическая модель, разработанная ISO (International Organization for Standardization), которая описывает, как данные передаются по сети. Модель OSI разбивает передачу данных на семь уровней, каждый из которых отвечает за определённые функции. Эта модель используется для стандартизации взаимодействия различных устройств и сетевых технологий, обеспечивая совместимость между ними.

Разберем все уровни OSI подробно:

---
### 1. **Физический уровень (Physical Layer)**
- **Функции**: физический уровень занимается передачей необработанных битов (0 и 1) по физической среде связи, будь то электрический сигнал, оптический сигнал или радиоволны. Он определяет механические и электрические параметры подключения.
- **Основные задачи**:
    - Определение физических характеристик интерфейсов и сред передачи (например, тип кабеля, частота сигнала).
    - Модуляция и демодуляция сигнала.
    - Синхронизация передачи битов (когда отправлять или считывать бит).
- **Примеры**: Ethernet-кабель, оптоволоконный кабель, радио-частотные каналы для Wi-Fi.
---
### 2. **Канальный уровень (Data Link Layer)**
- **Функции**: этот уровень отвечает за надёжную передачу данных через физическую среду, управляет доступом к физической среде и обеспечивает коррекцию ошибок, которые могут возникнуть на физическом уровне.
- **Основные задачи**:
    - Разделение потока данных на фреймы (кадры), которые включают в себя информацию об адресах отправителя и получателя.
    - Обнаружение и исправление ошибок (например, с помощью контрольной суммы).
    - Управление доступом к среде передачи (MAC – Media Access Control).
- **Примеры**: протоколы Ethernet, PPP (Point-to-Point Protocol), ARP (Address Resolution Protocol).
---
### 3. **Сетевой уровень (Network Layer)**
- **Функции**: сетевой уровень занимается маршрутизацией пакетов данных между разными сетями и адресацией устройств. Он определяет путь от отправителя до получателя, даже если они находятся в разных сетях.
- **Основные задачи**:
    - Логическая адресация (например, IP-адресация).
    - Маршрутизация данных через промежуточные узлы (роутеры).
    - Фрагментация и сборка пакетов, если данные слишком большие для передачи одним пакетом.
- **Примеры**: IP (Internet Protocol), ICMP (Internet Control Message Protocol), RIP (Routing Information Protocol).
---
### 4. **Транспортный уровень (Transport Layer)**
- **Функции**: транспортный уровень обеспечивает надёжную передачу данных между устройствами. Он разбивает данные на сегменты и следит за тем, чтобы они были получены в правильном порядке, обеспечивает проверку целостности.
- **Основные задачи**:
    - Надёжная доставка данных с проверкой целостности.
    - Разбиение данных на сегменты, контроль порядка доставки и повторная отправка потерянных сегментов.
    - Управление потоком данных, чтобы избежать перегрузки получателя.
- **Примеры**: TCP (Transmission Control Protocol), UDP (User Datagram Protocol).
---
### 5. **Сеансовый уровень (Session Layer)**
- **Функции**: сеансовый уровень управляет "сеансами" связи между приложениями. Он отвечает за установление, поддержание и завершение сеанса между устройствами, а также за синхронизацию данных.
- **Основные задачи**:
    - Управление и синхронизация диалога между двумя устройствами.
    - Восстановление сеанса в случае прерывания.
    - Организация управления сеансами, включая их открытие, ведение и завершение.
- **Примеры**: протоколы SMB (Server Message Block), PPTP (Point-to-Point Tunneling Protocol), NetBIOS.
---
### 6. **Уровень представления (Presentation Layer)**
- **Функции**: уровень представления отвечает за форматирование данных и преобразование между форматами, чтобы устройства могли "понимать" друг друга. Он также занимается шифрованием и сжатием данных.
- **Основные задачи**:
    - Кодирование и преобразование данных (например, преобразование текста из ASCII в Unicode).
    - Шифрование данных для обеспечения безопасности.
    - Сжатие данных для уменьшения объёма передаваемой информации.
- **Примеры**: JPEG, PNG, TLS (Transport Layer Security), SSL (Secure Sockets Layer).
---
### 7. **Прикладной уровень (Application Layer)**

- **Функции**: прикладной уровень предоставляет интерфейсы и протоколы для работы конечных приложений с сетью. Здесь находится большинство протоколов, используемых конечными пользователями.
- **Основные задачи**:
    - Определение формата передачи данных между приложениями.
    - Предоставление доступа к сети для программ, таких как браузеры, почтовые клиенты, мессенджеры.
    - Управление параметрами, которые позволяют пользователям взаимодействовать с сетью.
- **Примеры**: HTTP (Hypertext Transfer Protocol), FTP (File Transfer Protocol), SMTP (Simple Mail Transfer Protocol), DNS (Domain Name System).
---
### Пример передачи данных по модели OSI
Рассмотрим, как данные проходят по всем уровням модели OSI при передаче, например, веб-страницы:
1. **Прикладной уровень**: пользователь отправляет запрос на веб-страницу, например, набирая URL-адрес в браузере. Браузер формирует HTTP-запрос.
2. **Уровень представления**: данные HTTP-запроса шифруются (например, если это HTTPS-сайт).
3. **Сеансовый уровень**: устанавливается сессия, которая управляет состоянием соединения.
4. **Транспортный уровень**: данные разбиваются на сегменты, и к каждому сегменту добавляется порядковый номер.
5. **Сетевой уровень**: каждый сегмент инкапсулируется в пакет, которому присваивается IP-адрес назначения.
6. **Канальный уровень**: каждый пакет данных инкапсулируется в кадр, которому добавляется MAC-адрес.
7. **Физический уровень**: кадры преобразуются в сигналы, передающиеся через кабели или беспроводное соединение до конечного устройства.
На стороне получателя эти уровни работают в обратном порядке, начиная с физического, где сигналы преобразуются в кадры, которые затем обрабатываются на канальном уровне, и так далее, пока данные не дойдут до прикладного уровня.
---
### Резюме: зачем нужна модель OSI?
Модель OSI предоставляет стандартизированную структуру для взаимодействия сетевых устройств и протоколов, что позволяет разработчикам создавать совместимые между собой системы и устройства. Она служит основой для понимания сетевой архитектуры, упрощает разработку новых технологий и помогает в диагностике и устранении неисправностей. Модель OSI стала фундаментом сетевой инженерии, облегчая взаимную интеграцию и модернизацию технологий.

## Http

**HTTP (Hypertext Transfer Protocol)** — это протокол прикладного уровня, который служит основой для передачи гипертекста (веб-страниц) в Интернете. HTTP изначально был разработан для передачи HTML-документов, но со временем стал универсальным протоколом для обмена различными типами данных.

### Основные особенности HTTP

1. **Простота**: HTTP основывается на модели "запрос-ответ", где клиент отправляет запрос, а сервер возвращает ответ. Каждый запрос и ответ формируется в виде текстовых сообщений, что упрощает отладку и анализ.
2. **Безопасность**: протокол HTTP не обеспечивает безопасность по умолчанию. Для обеспечения конфиденциальности и целостности данных используется его защищённая версия — HTTPS.
3. **Статус-коды**: HTTP использует систему числовых кодов, чтобы указывать результат выполнения запроса (например, 200 OK, 404 Not Found).
4. **Без сохранения состояния**: HTTP является статeless-протоколом, то есть каждое взаимодействие между клиентом и сервером является независимым. Сервер не хранит информацию о предыдущих запросах. Для хранения сессий применяются механизмы, такие как cookies.

### Как работает HTTP

Работа HTTP начинается с открытия соединения между клиентом (например, браузером) и сервером, на котором находится запрашиваемый ресурс. После этого клиент отправляет запрос, сервер обрабатывает его и возвращает ответ. Давайте рассмотрим структуру HTTP-запроса и HTTP-ответа подробнее.

---

### Структура HTTP-запроса

HTTP-запрос состоит из следующих частей:

1. **Стартовая строка**:
   - **Метод запроса**: указывает, что именно клиент хочет сделать с ресурсом (например, получить его, изменить или удалить).
   - **URI (Uniform Resource Identifier)**: уникальный идентификатор ресурса (например, `/index.html`).
   - **Версия протокола HTTP**: указывает версию протокола (например, HTTP/1.1).

   Пример стартовой строки:
   ```
   GET /index.html HTTP/1.1
   ```

2. **Заголовки HTTP**: это дополнительные параметры, которые содержат информацию о запросе и клиенте. Они передаются в виде пар "имя: значение" и разделены переводом строки.
   - **User-Agent**: информация о клиентском приложении (например, браузере).
   - **Host**: доменное имя сервера.
   - **Accept**: типы данных, которые клиент может обрабатывать.
   - **Authorization**: данные для аутентификации.

   Пример заголовков:
   ```
   Host: www.example.com
   User-Agent: Mozilla/5.0
   Accept: text/html
   ```

3. **Тело (payload)**: используется в запросах, таких как POST и PUT, чтобы отправить данные на сервер. Это может быть, например, JSON с информацией о новом ресурсе или данные формы из веб-страницы.

---

### Основные методы HTTP

HTTP поддерживает несколько методов, которые указывают на тип действия, которое клиент хочет выполнить. Вот самые распространённые из них:

- **GET**: запрашивает представление ресурса. Этот метод является идемпотентным (не изменяет ресурс) и кэшируемым.
- **POST**: отправляет данные на сервер, часто используется для отправки форм или создания новых ресурсов. Этот метод не является идемпотентным (запрос может изменять ресурс).
- **PUT**: заменяет ресурс новыми данными. Если ресурс не существует, сервер может создать его.
- **DELETE**: удаляет указанный ресурс.
- **HEAD**: запрашивает заголовки ресурса, не получая само тело, что позволяет узнать информацию о ресурсе (например, дату последнего изменения).
- **OPTIONS**: запрашивает методы, поддерживаемые сервером для конкретного ресурса.

---

### Структура HTTP-ответа

HTTP-ответ, который возвращает сервер, также состоит из нескольких частей:

1. **Стартовая строка**:
   - **Версия HTTP**: версия протокола (например, HTTP/1.1).
   - **Статус-код**: трёхзначное число, указывающее на результат выполнения запроса (например, 200, 404, 500).
   - **Статусное сообщение**: краткое текстовое описание статус-кода (например, OK, Not Found).

   Пример стартовой строки:
   ```
   HTTP/1.1 200 OK
   ```

2. **Заголовки HTTP**: содержат метаданные о возвращаемом ресурсе, схожие с заголовками запроса, но с дополнительной информацией от сервера.
   - **Content-Type**: указывает тип данных в теле ответа (например, text/html, application/json).
   - **Content-Length**: размер содержимого в байтах.
   - **Set-Cookie**: установка cookies для сохранения сессии.
   - **Server**: информация о программном обеспечении сервера.

   Пример заголовков:
   ```
   Content-Type: text/html
   Content-Length: 1024
   Server: Apache/2.4.1 (Unix)
   ```

3. **Тело (payload)**: содержит сам ресурс, например, HTML-код веб-страницы, изображение или JSON.

---

### Статус-коды HTTP

HTTP использует трёхзначные числовые коды для обозначения статуса запроса. Статус-коды делятся на пять категорий:

1. **1xx (Информационные)**: запрос принят и обрабатывается (например, 100 Continue).
2. **2xx (Успешные)**: запрос был успешно выполнен (например, 200 OK, 201 Created).
3. **3xx (Перенаправления)**: клиенту нужно выполнить дополнительные действия для завершения запроса (например, 301 Moved Permanently, 302 Found).
4. **4xx (Ошибки клиента)**: ошибка на стороне клиента, запрос не может быть выполнен (например, 400 Bad Request, 404 Not Found).
5. **5xx (Ошибки сервера)**: ошибка на стороне сервера, запрос не может быть выполнен из-за внутренней проблемы (например, 500 Internal Server Error, 503 Service Unavailable).

---

### Версии HTTP

1. **HTTP/0.9**: первая версия протокола, поддерживала только метод GET и текстовые ответы.
2. **HTTP/1.0**: добавлены методы POST и HEAD, введены заголовки, но соединение закрывалось после каждого запроса.
3. **HTTP/1.1**: стала основной версией, ввела поддержание соединения (keep-alive), что позволяло повторно использовать одно и то же соединение для нескольких запросов. Также были добавлены новые методы и кэширование.
4. **HTTP/2**: увеличивает скорость загрузки страниц за счёт мультиплексирования (передача нескольких запросов в одном соединении), сжатия заголовков и асинхронного управления потоками данных.
5. **HTTP/3**: использует транспортный протокол QUIC вместо TCP для снижения задержек, обеспечивает ещё более быстрое и надёжное соединение.

---

### Безопасный HTTP (HTTPS)

**HTTPS** – это расширение HTTP, использующее TLS (Transport Layer Security) или SSL (Secure Sockets Layer) для шифрования данных. Основные преимущества HTTPS:

- **Шифрование**: все данные между клиентом и сервером защищены от перехвата.
- **Аутентификация**: подтверждает подлинность сервера и предотвращает атаки "человек посередине" (MITM).
- **Целостность данных**: проверка целостности сообщения, чтобы убедиться, что данные не были изменены.

---

### Примеры работы HTTP

1. **Запрос GET**:
   - Клиент отправляет запрос GET, чтобы получить ресурс с сервера, например, веб-страницу.
   - Сервер обрабатывает запрос и возвращает ответ с кодом состояния и телом HTML-страницы.

   ```
   GET /index.html HTTP/1.1
   Host: www.example.com
   ```

2. **Запрос POST**:
   - Клиент отправляет данные на сервер (например, данные формы регистрации) с помощью POST-запроса.
   - Сервер обрабатывает данные, сохраняет их и отправляет ответ с кодом состояния.

   ```
   POST /submit-form HTTP/1.1
   Host: www.example.com
   Content-Type: application/x-www-form-urlencoded
   Content-Length: 32

   username=user&password=pass
   ```

---

## FTP

**FTP (File Transfer Protocol)** — это протокол прикладного уровня, который используется для передачи файлов между компьютерами в сети, такой как Интернет или локальная сеть. Он позволяет пользователям загружать, скачивать, удалять и управлять файлами на удалённом сервере. FTP работает на модели клиент-сервер, где один компьютер (клиент) подключается к другому компьютеру (серверу), чтобы передать или получить файлы.

### Основные характеристики FTP

1. **Передача файлов**: FTP оптимизирован для работы с файлами, обеспечивая их надёжную передачу между клиентом и сервером.
2. **Поддержка авторизации**: доступ к FTP-серверу может быть защищён логином и паролем. Однако, базовый FTP передаёт данные и авторизационные данные в открытом виде, без шифрования.
3. **Двухканальная архитектура**: FTP использует два соединения для передачи данных:
   - **Командное соединение (Control Connection)**: используется для отправки команд и ответов между клиентом и сервером.
   - **Данные (Data Connection)**: используется непосредственно для передачи файлов.

### Как работает FTP

Работа FTP основана на последовательности команд, которые отправляет клиент, и ответов, которые возвращает сервер. После подключения клиент может передавать команды, чтобы получить список файлов, загрузить файл на сервер или скачать его с сервера. В ответ сервер подтверждает выполнение каждой команды с использованием кодов состояния.

#### Основные шаги работы FTP:
1. **Установка соединения**: клиент подключается к серверу через TCP-соединение, используя стандартный порт FTP (обычно **порт 21**).
2. **Аутентификация**: клиент отправляет свои учётные данные (логин и пароль) для доступа к серверу. Некоторые серверы позволяют анонимное подключение, не требующее авторизации.
3. **Отправка команд**: после успешного входа клиент отправляет команды (например, LIST, RETR, STOR), а сервер отвечает кодами состояния и текстовыми сообщениями.
4. **Передача данных**: когда требуется передать файлы, FTP открывает второе соединение для передачи данных (Data Connection).
5. **Завершение сессии**: после завершения передачи клиент закрывает соединение.

### Двухканальная архитектура FTP: режимы передачи

FTP использует два соединения для передачи данных:

1. **Командное соединение (Control Connection)**:
   - Это основное соединение, которое устанавливается на порте 21 и остаётся открытым на протяжении всей сессии.
   - Через него передаются команды (например, LIST, RETR) и ответы сервера (например, 200 OK, 550 File not found).
   
2. **Данные (Data Connection)**:
   - Вторичное соединение, которое открывается только на время передачи данных (например, для загрузки или скачивания файла).
   - Использует отдельный порт для каждого сеанса передачи.
   - Могут использоваться разные режимы передачи: активный и пассивный.

#### Активный и пассивный режимы передачи

FTP может работать в **активном** или **пассивном** режиме, в зависимости от того, кто инициализирует соединение для передачи данных.

- **Активный режим**:
   - Клиент сообщает серверу порт для передачи данных, а сервер инициирует подключение к этому порту.
   - Этот режим может быть проблематичным для клиентов за брандмауэрами или NAT, так как он требует открытого порта на стороне клиента.

- **Пассивный режим**:
   - Сервер сообщает клиенту порт, на котором он будет ждать подключения, и клиент инициирует соединение.
   - Пассивный режим удобнее для обхода брандмауэров и NAT, так как соединение устанавливается с клиента на сервер.

### Основные команды FTP

FTP использует ряд текстовых команд для управления передачей файлов. Вот некоторые из них:

- **USER**: отправка имени пользователя для аутентификации.
- **PASS**: отправка пароля для аутентификации.
- **LIST**: получение списка файлов и директорий.
- **RETR**: скачивание файла с сервера.
- **STOR**: загрузка файла на сервер.
- **DELE**: удаление файла на сервере.
- **MKD**: создание новой директории на сервере.
- **PWD**: вывод текущей рабочей директории.
- **CWD**: смена рабочей директории.
- **QUIT**: завершение соединения с сервером.

---

### Статус-коды FTP

Каждая команда, отправленная клиентом, получает ответ от сервера с использованием статус-кодов. Эти коды обычно состоят из трёх цифр и классифицируются следующим образом:

- **1xx**: Положительное предварительное ответное сообщение (например, 150 File status okay).
- **2xx**: Успешное завершение (например, 200 Command okay, 226 Closing data connection).
- **3xx**: Условное завершение (например, 331 Username okay, need password).
- **4xx**: Временная ошибка (например, 421 Service not available).
- **5xx**: Постоянная ошибка (например, 530 Not logged in, 550 Requested action not taken).

---

### Безопасность FTP

Обычный FTP не обеспечивает шифрования передаваемых данных, что делает его уязвимым для перехвата трафика. Логины, пароли и передаваемые файлы передаются в открытом виде, и их можно легко перехватить. Для повышения безопасности были разработаны следующие расширения:

1. **FTPS (FTP Secure)**:
   - Использует SSL/TLS для шифрования данных.
   - Требует настройки сертификатов на сервере.
   - Существует два режима работы FTPS:
      - **ИмPLICIT FTPS**: требует шифрования соединения по умолчанию на порту 990.
      - **Явный FTPS**: клиент и сервер соглашаются использовать шифрование по запросу клиента.

2. **SFTP (SSH File Transfer Protocol)**:
   - Часто путается с FTP, но является совершенно другим протоколом.
   - Работает поверх SSH и использует порт 22.
   - Предоставляет шифрование данных, но не использует протокол FTP; вместо этого поддерживает свои собственные команды.

---

### Примеры использования FTP

1. **Загрузка файла на сервер**:
   - Клиент подключается к серверу и проходит аутентификацию.
   - Отправляет команду `STOR` с указанием имени файла.
   - Сервер открывает соединение для передачи данных, получает файл и закрывает соединение.

2. **Скачивание файла с сервера**:
   - Клиент подключается к серверу, проходит аутентификацию.
   - Отправляет команду `RETR`, указывая имя файла.
   - Сервер открывает соединение для передачи данных и отправляет файл клиенту.

---

### Применение FTP

FTP применяется для различных задач, таких как:
- Загрузка и обновление веб-страниц на сервер.
- Передача больших файлов между устройствами в локальных сетях.
- Хранение и управление резервными копиями файлов на удалённых серверах.

---

### Заключение

FTP остаётся одним из старейших и надёжных протоколов для передачи файлов, хотя сегодня его часто заменяют более безопасные методы, такие как SFTP и FTPS, из-за требований к шифрованию и безопасности.

## TLS and SSL
**TLS (Transport Layer Security)** и **SSL (Secure Sockets Layer)** — это криптографические протоколы, разработанные для обеспечения безопасности данных при их передаче по сети. Эти протоколы шифруют соединения, защищая их от перехвата и подмены данных, что делает их особенно важными для приложений, работающих с конфиденциальной информацией, таких как интернет-банкинг и электронная коммерция.
https://www.cloudflare.com/en-gb/learning/ssl/how-does-ssl-work/
https://habr.com/ru/companies/varonis/articles/321522/#comment_26559581
### История и различия между SSL и TLS

- **SSL** был первым из этих протоколов и был создан компанией Netscape в середине 1990-х годов. Сначала существовали версии **SSL 1.0** (не была выпущена), **SSL 2.0** и **SSL 3.0**.
- **TLS** является преемником SSL. В 1999 году была представлена первая версия TLS, **TLS 1.0**, как обновление SSL 3.0, чтобы улучшить безопасность. После неё последовали версии **TLS 1.1**, **TLS 1.2**, и самая современная — **TLS 1.3** (выпущена в 2018 году).

Протоколы TLS и SSL функционально похожи, но TLS обладает более высокой безопасностью и поддерживает новые алгоритмы шифрования. Сегодня SSL уже считается устаревшим и небезопасным, и большинство систем используют только TLS.

### Основные цели и функции TLS/SSL

1. **Конфиденциальность**: данные шифруются так, что только участники соединения могут их читать.
2. **Целостность**: каждый фрагмент данных снабжается проверочной суммой (хэш-функцией), которая предотвращает изменение данных третьими лицами.
3. **Аутентификация**: сервер, а иногда и клиент, проверяются на подлинность с помощью цифровых сертификатов.

---

### Как работает TLS/SSL

Соединение TLS/SSL начинается с так называемого **рукопожатия** (handshake), в ходе которого сервер и клиент договариваются об условиях соединения, включая алгоритмы шифрования и ключи.

#### Основные этапы работы TLS

1. **Установка соединения и рукопожатие (Handshake)**:
   - **Обмен версиями и настройками**: клиент и сервер договариваются о версии протокола, которая будет использоваться.
   - **Обмен ключами шифрования**: происходит генерация ключей, которые будут использоваться для шифрования. Обычно это выполняется через асимметричное шифрование (например, RSA).
   - **Аутентификация сервера**: клиент проверяет сертификат сервера, чтобы удостовериться, что он подлинный.
   - **Генерация симметричного ключа**: после того как сервер прошёл аутентификацию, клиент и сервер создают симметричный ключ, который будет использоваться для шифрования данных в дальнейшем.

2. **Передача данных**:
   - После успешного завершения рукопожатия устанавливается защищённое соединение. Данные, отправляемые между клиентом и сервером, шифруются симметричным ключом.
   - Используются хеш-функции для контроля целостности данных.

3. **Закрытие соединения**:
   - Когда передача данных завершается, клиент и сервер закрывают соединение, что предотвращает дальнейший обмен данными.

---

### Основные криптографические механизмы в TLS/SSL

1. **Асимметричное шифрование**:
   - Используется на начальном этапе для обмена ключами и аутентификации сервера. Например, сервер может использовать RSA или ECDSA для подтверждения своей подлинности.

2. **Симметричное шифрование**:
   - После установки соединения применяется симметричное шифрование для передачи данных. Примеры алгоритмов: AES, ChaCha20.
   - Симметричное шифрование быстрее, чем асимметричное, поэтому оно используется для всех данных после рукопожатия.

3. **Хеширование (HMAC)**:
   - Для проверки целостности сообщений в TLS/SSL используется HMAC (Hash-based Message Authentication Code) с алгоритмами, такими как SHA-256 или SHA-3.

### Версии TLS и SSL

1. **SSL 2.0 и SSL 3.0**:
   - SSL 2.0 был первым выпущенным вариантом SSL, но имел множество уязвимостей.
   - SSL 3.0 стал более защищённым, но к настоящему времени также считается небезопасным из-за множества атак, таких как POODLE.

2. **TLS 1.0 и TLS 1.1**:
   - TLS 1.0 был первым обновлением SSL и уже включал поддержку более безопасных хеш-функций.
   - TLS 1.1 добавил защиту от некоторых атак, но обе версии устарели и практически не используются из-за уязвимостей.

3. **TLS 1.2**:
   - Стал основным стандартом с середины 2000-х и широко используется.
   - Поддерживает более сильные алгоритмы шифрования и хеширования, позволяет выбрать конкретные алгоритмы для рукопожатия, повышая гибкость и безопасность.

4. **TLS 1.3**:
   - Современная версия, значительно упростившая процесс рукопожатия, что привело к повышению скорости соединения.
   - Поддерживает только самые надёжные алгоритмы и устраняет слабые элементы, такие как использование RSA для обмена ключами.
   - Включает только одно обменное рукопожатие, что сокращает время соединения и улучшает производительность.

---

### Уязвимости и атаки

1. **POODLE**: атака на SSL 3.0, которая позволяет злоумышленнику расшифровать данные.
2. **BEAST**: атака на CBC-режим шифрования в TLS 1.0, позволяющая расшифровать отдельные данные.
3. **Heartbleed**: критическая уязвимость в библиотеке OpenSSL, позволявшая злоумышленнику читать данные из памяти сервера.
4. **CRIME и BREACH**: атаки, направленные на компрометацию данных, используя сжатие, применяемое в SSL/TLS.

---

### Заключение

TLS и SSL играют важнейшую роль в обеспечении безопасности онлайн-коммуникаций, защищая данные от перехвата и подмены. На данный момент TLS 1.3 считается самым надёжным вариантом для шифрования, и все современные системы и браузеры его поддерживают.

## SMTP
**SMTP (Simple Mail Transfer Protocol)** — это протокол прикладного уровня, используемый для отправки и пересылки электронной почты через интернет. Он обеспечивает передачу сообщений от клиента (почтового клиента) к серверу или между серверами и является основным стандартом для передачи электронной почты.

### Основные характеристики SMTP

1. **Служит для отправки писем**: SMTP отвечает за отправку сообщений от почтовых клиентов к почтовым серверам и между почтовыми серверами. Для получения писем используются другие протоколы, такие как IMAP или POP3.
2. **Работает поверх TCP**: SMTP использует надёжный протокол TCP и работает обычно на порту **25**. В некоторых случаях также используется порт **587** для безопасной передачи данных и порт **465** для зашифрованного соединения (SMTPS).
3. **Простой текстовый протокол**: команды и ответы в SMTP отправляются в виде текста, что позволяет легко интерпретировать и отлаживать их.

### Как работает SMTP

SMTP работает по модели клиент-сервер, где клиент инициирует соединение и отправляет сообщение серверу. Протокол включает следующие шаги:

1. **Установка соединения**: клиент SMTP устанавливает соединение с сервером SMTP через TCP.
2. **Аутентификация** (опционально): если сервер SMTP настроен на требование аутентификации, клиент отправляет логин и пароль.
3. **Обмен командами и данными**: клиент и сервер обмениваются командами SMTP и ответами, такими как HELO (приветствие), MAIL FROM (отправитель), RCPT TO (получатель), DATA (начало сообщения) и QUIT (завершение).
4. **Передача сообщения**: после успешного выполнения команд сообщение передаётся от клиента к серверу.
5. **Завершение соединения**: после передачи сообщения соединение между клиентом и сервером закрывается.

### Основные команды SMTP

- **HELO/EHLO**: используется клиентом для представления серверу. EHLO — это расширенная версия HELO, позволяющая использовать дополнительные возможности SMTP.
- **MAIL FROM**: определяет адрес отправителя сообщения.
- **RCPT TO**: определяет адрес получателя.
- **DATA**: указывает начало тела сообщения. После этой команды клиент отправляет текст письма, заканчивая его точкой на новой строке.
- **QUIT**: завершает соединение с сервером SMTP.

#### Пример передачи электронной почты по SMTP:

```plaintext
Client: HELO example.com
Server: 250 Hello example.com
Client: MAIL FROM:<sender@example.com>
Server: 250 OK
Client: RCPT TO:<recipient@example.com>
Server: 250 OK
Client: DATA
Server: 354 Start mail input; end with <CRLF>.<CRLF>
Client: Subject: Test Email
Client: Hello, this is a test message!
Client: .
Server: 250 OK: message accepted for delivery
Client: QUIT
Server: 221 Bye
```

---

### Механизмы безопасности в SMTP

Изначально SMTP был разработан без встроенных механизмов безопасности, из-за чего он уязвим к перехвату и подмене данных. Чтобы защитить данные, были добавлены расширения и дополнительные протоколы:

1. **STARTTLS**: расширение SMTP, которое позволяет использовать шифрование TLS поверх существующего соединения, защищая данные от перехвата.
2. **SMTP AUTH**: механизм аутентификации, требующий от отправителя подтверждения подлинности с использованием логина и пароля.
3. **SMTPS (SMTP Secure)**: это зашифрованная версия SMTP, которая использует порт 465 и сразу устанавливает защищённое соединение с использованием TLS/SSL.

---

### SMTP-серверы и маршрутизация писем

Для передачи электронных писем через SMTP используются серверы:

- **Клиентский SMTP-сервер**: принимает письмо от почтового клиента и передаёт его дальше.
- **Промежуточные SMTP-серверы**: могут быть использованы для маршрутизации письма на основе DNS-записей и домена получателя.
- **Конечный SMTP-сервер**: сервер, обслуживающий домен получателя, сохраняет письмо в почтовом ящике пользователя.

SMTP использует DNS-записи MX (Mail Exchange), чтобы определить, какой сервер отвечает за получение почты для конкретного домена.

---

### Ограничения SMTP

1. **Отсутствие встроенного шифрования**: сообщения передаются в открытом виде, что требует дополнительных мер безопасности, таких как TLS.
2. **Ограниченная аутентификация**: изначально SMTP не поддерживал аутентификацию, что привело к злоупотреблениям, например, спаму. Современные расширения SMTP, такие как SMTP AUTH, решают эту проблему.
3. **Ограничение размера сообщений**: многие SMTP-серверы ограничивают размер сообщения (обычно 10–25 МБ), что не позволяет передавать большие файлы.

---

### Заключение

SMTP — один из старейших и надёжных протоколов интернета, играющий важнейшую роль в работе электронной почты. Сегодня он активно используется для передачи сообщений, хотя для его защиты требуется внедрение дополнительных механизмов шифрования и аутентификации.